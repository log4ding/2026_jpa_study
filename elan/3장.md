# 3장. 영속성 관리

## 3.1 엔티티 매니저 팩토리와 엔티티 매니저

- 엔티티 매니저는 스레드의 동시성 문제가 발생할수 있으므로 공유하면 안됌.


## 3.2 영속성 컨텍스트

## 3.3 엔티티 생명주기

- 비영속, 영속, 준영속, 삭제
- 영속: 엔티티 매니저를 통해서 엔티티를 영속성 컨텍스트에 저장


## 3.4 영속성 컨텍스트의 특징

- 영속상태는 반드시 식별값이 있어야함.

### 3.4.1 엔티티 조회

- 1차 캐시가 있고 동일한 인스턴스를 반환 성능적인 이점을 챙길수 있음.

### 3.4.2 엔티티 등록

- 쓰기 지연을 지원하며, 영속성 컨텍스트를 통해서 DB에 적용되기 전까지 저장된것처럼 사용할수 있음

### 3.4.3 엔티티 수정

- 변경감지(dirty checking) 기술 제공
- 영속상태의 엔티티에만 적용되고 스냅샷을 이용하여 비교.

### 3.4.4 엔티티 삭제

- 삭제 또안 지연저장되며 재사용되지 않게 GC 대상으로 되게해주는게 좋음.

## 3.5 플러시

- 영속성 컨텍스트의 변경 내용을 DB에 반영

### 3.5.1 플러시 모드 옵션

- AUTO, COMMIT

## 3.6 준영속

### 3.6.1 준영속 상태로 전환: detach()

- 특정 엔티티를 준영속 상태로 전환

### 3.6.2 영속성 컨텍스트 초기화: clear()

- 영속성 컨텍스트를 초기화

### 3.6.3 영속성 컨텍스트 종료: close()

- 영속성 컨텍스트를 종료 (더이상 em 을 사용할수 없는걸것 같음)

### 3.6.4 준영속 상태의 특징

- 지연로딩을 할수 없음 > 필요할수도 있겠지만 문제 발생시 찾는게 굉장히 어려울듯.

### 3.6.5 병합 merge()

- 준영속 상태의 엔티티를 다시 영속상태로 변경 (비영속도 가능)
