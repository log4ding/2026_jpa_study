# 5장. 연관관계 매핑 기초

> 참고: https://jny0.tistory.com/139

---

## 핵심 개념 3가지

| 개념 | 설명 |
|------|------|
| **방향** | 단방향 / 양방향 |
| **다중성** | 다대일, 일대다, 일대일, 다대다 |
| **연관관계 주인** | 양방향일 때 FK를 관리하는 쪽 |

---

## 객체 vs 테이블의 차이

```
[객체]  Member → Team (참조로 연관관계)
        → 단방향만 가능
        → 양방향 원하면 단방향 2개 만들어야 함

[테이블] MEMBER ↔ TEAM (FK로 연관관계)
         → 자연스럽게 양방향 (JOIN)
```

---

## 다대일 단방향 vs 양방향

### 단방향
```java
@Entity
public class Member {
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;  // Member → Team만 가능
}

@Entity
public class Team {
    // members 필드 없음!
}
```

### 양방향
```java
@Entity
public class Member {
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;  // 연관관계 주인 (FK 관리)
}

@Entity
public class Team {
    @OneToMany(mappedBy = "team")  // 읽기 전용
    private List<Member> members;
}
```

| 구분 | 단방향 | 양방향 |
|------|--------|--------|
| DB 테이블 | 동일 | 동일 |
| 객체 탐색 | Member → Team만 | 양쪽 모두 |

---

## 연관관계 주인 (mappedBy)

- **주인**: FK가 있는 쪽 (Member.team)
- **주인 아닌 쪽**: `mappedBy` 속성 사용 (Team.members)
- **주인만 FK를 등록/수정 가능**, 주인 아닌 쪽은 읽기만

---

## 양방향 주의점: 1차 캐시 문제

```java
member.setTeam(team);  // DB 반영 O

// flush 전
team.getMembers().size();  // 0 (1차 캐시는 갱신 안됨!)

// flush/clear 후 재조회
team.getMembers().size();  // 1 (DB에서 새로 읽음)
```

**해결: 양쪽 다 설정**
```java
member.setTeam(team);
team.getMembers().add(member);  // 1차 캐시 정합성
```