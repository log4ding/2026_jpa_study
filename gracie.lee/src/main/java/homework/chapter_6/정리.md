# 6장. 다양한 연관관계 매핑

> 참고: https://jny0.tistory.com/161

---

## 연관관계 매핑 시 고려사항

1. **다중성**: 다대일? 일대다? 일대일? 다대다?
2. **방향**: 단방향? 양방향?
3. **연관관계 주인**: 양방향이면 누가 FK 관리?

> **핵심 원칙: FK는 항상 "다" 쪽에 있다**

---

## 1. 다대일 (N:1)

### 다대일 단방향 (가장 많이 사용)
```java
@Entity
public class Member {
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;
}
```

### 다대일 양방향
```java
// Member (연관관계 주인)
@ManyToOne
@JoinColumn(name = "TEAM_ID")
private Team team;

// Team (읽기 전용)
@OneToMany(mappedBy = "team")
private List<Member> members;
```

---

## 2. 일대다 (1:N)

### 일대다 단방향 (권장하지 않음)
```java
@Entity
public class Team {
    @OneToMany
    @JoinColumn(name = "TEAM_ID")  // Member 테이블의 FK
    private List<Member> members;
}
```

**단점**:
- "1" 쪽에서 FK 관리 → 다른 테이블에 UPDATE 발생
- 다대일 양방향 사용 권장

---

## 3. 일대일 (1:1)

**특징**: 어느 쪽이든 FK 가질 수 있음

### 주 테이블에 FK (선호)
```java
@Entity
public class Member {
    @OneToOne
    @JoinColumn(name = "LOCKER_ID")
    private Locker locker;
}
```

### 대상 테이블에 FK
```java
@Entity
public class Locker {
    @OneToOne
    @JoinColumn(name = "MEMBER_ID")
    private Member member;
}
```

| FK 위치 | 장점 | 단점 |
|---------|------|------|
| 주 테이블 | 객체지향적, 주 테이블만 조회해도 확인 가능 | 값 없으면 null |
| 대상 테이블 | 1:N으로 변경 시 유리 | 지연 로딩 불가 |

---

## 4. 다대다 (N:M)

### 문제점
- 연결 테이블에 **추가 컬럼 불가** (주문일, 수량 등)
- 실무에서 거의 사용 안 함

### 해결: 연결 엔티티 사용
```java
// 다대다 → 일대다 + 다대일로 풀기
@Entity
public class MemberProduct {
    @ManyToOne
    private Member member;

    @ManyToOne
    private Product product;

    private int orderAmount;  // 추가 컬럼 가능!
    private LocalDateTime orderDate;
}
```

---

## 정리

| 관계 | 권장 매핑 |
|------|----------|
| 다대일 | **다대일 양방향** (가장 많이 사용) |
| 일대다 | 다대일 양방향으로 변경 권장 |
| 일대일 | 주 테이블에 FK |
| 다대다 | 연결 엔티티로 풀어서 사용 |
